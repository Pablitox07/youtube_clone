<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Player</title>
  {% load static %}
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  {% include "header.html" %}

  <div class="container mt-5">
    <!-- Video player -->
    <div class="mb-4">
      <video id="player" playsinline controls class="w-100 rounded">
        <source src="{{ video_path }}" type="video/mp4" />
        Your browser does not support HTML5 video.
      </video>
    </div>

    <h2 class="mb-4">{{ title }}</h2>

    <!-- Uploader and stats -->
    <div class="d-flex align-items-center mb-3">
      <img src="{{ uploader_profile_pic }}" alt="Profile Picture" class="rounded-circle me-2" width="50" height="50">
      <div>
        <strong>{{ uploader_username }}</strong><br>
        <small>{{ video_views }} views</small>
      </div>
    </div>

    <!-- Description -->
    <div class="mb-3">
      <p>{{ description }}</p>
    </div>

    <!-- Like / Dislike buttons with counts -->
    <div class="mb-4 d-flex align-items-center">
      <button class="btn btn-outline-success me-2" id="video_like_buton">
        Like ({{ likes }})
      </button>
    
      <button class="btn btn-outline-danger" id="video_dislike_buton">
        Dislike ({{ dislikes }})
      </button>
    </div>
    

    <!-- Comments Section -->
    <div class="mt-5">
      <h4>Comments</h4>
        <div id="error-message" class="alert alert-danger d-none" role="alert"></div>
        <textarea name="comment" class="form-control mb-2" placeholder="Add a comment..." rows="2" id="comment_text_are"></textarea>
        <button class="btn btn-secondary" id="publish_comment_button">Post Comment</button>

      <ul class="list-group mt-3" id="comment_seccion_ul">
        {% for comment in comments %}
          <li class="list-group-item">
            <div class="d-flex align-items-start">
              <!-- Profile Picture -->
              <img src="{{ comment.profile_pic_url }}" alt="Profile" class="rounded-circle me-3" width="40" height="40">
      
              <div class="flex-grow-1">
                <!-- Username and Date -->
                <div class="d-flex justify-content-between">
                  <strong>{{ comment.user }}</strong>
                  <small class="text-muted">{{ comment.created_at }}</small>
                </div>
      
                <!-- Comment Text -->
                <span>{{ comment.text }}</span>
      
                <!-- Like/Dislike Buttons -->
                <div class="mt-2 d-flex align-items-center gap-2">
                  <button class="btn btn-sm btn-outline-success">Like ({{ comment.likes }})</button>
                  <button class="btn btn-sm btn-outline-danger">Dislike ({{ comment.dislikes }})</button>
                </div>
              </div>
            </div>
          </li>
        {% empty %}
          <li class="list-group-item" id="comment_text_when_no_comments">No comments yet.</li>
        {% endfor %}
      </ul>
      
      
    </div>
  </div>

  <!-- Plyr JS -->
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script>
    let like_dislike_status = "";
    let received_likes = parseInt("{{ likes }}", 10); 
    let received_dislikes = parseInt("{{dislikes}}", 10)
    const received_video_id = "{{ video_id }}"; 
    document.addEventListener("DOMContentLoaded", () => {
      const player = new Plyr('#player');
    });
  </script>
  <script type="module" src="/static/js/videos_view.js"></script>
</body>
</html>
